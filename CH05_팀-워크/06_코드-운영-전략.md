## 코드 운영 전략

```
1. 물리적 형식
2. 논리적 형식
3. 무엇을 선택해야할까?
```

### 물리적인 형식

#### 멀티 레포 vs. 모노 레포

멀티 레포<br />

- 성격이 다른 레포가 생성되는 현상 - OK<br />
- 성격이 유사한 레포가 생성되는 현상 - Not OK<br />
  예를 들면, 12shop의 `web1`, `web2`, `webview1`와 같은 레파지토리들은 전부 다 프론트엔드 웹앱을 개발하는 레파지토리라고 할 수 있다. 이것은 성격이 유사한 레파지토리라고 할 수 있다. 왜냐하면 12shop이라고 하는 서비스의 일부를 담당하고 있는 애플리케이션들이니까 말이다. 이 레파지토리들은 물리적으로는 분리되어 있으나, 논리적으로는 유사한 컴포넌트나 공통 로직을 들고 있는 코드나 모듈들이 들어있을 가능성이 굉장히 높다. 그런데 독립된 레파지토리이기 때문에 이걸 공유할 방법은 사실 마땅히 없는 상태다. 그래서 이런 성격이 유사한 레파지토리가 많이 늘어나면 늘어날수록 모두 다 사실상 중복 코드라고 확정할 수 있을 것이고, 중복 코드는 우리가 알다시피 굉장히 나쁜거기 때문에 ^^; (변경이 일어나면 쫓아다니면서 레파지토리마다 수정하고, 그걸 레파지토리마다 배포하고 해야되니까 굉장히 어려운 일이 된다.)<br />
  그래서 성격이 비슷한 레파지토리들이 많이 발견되는 상황이라면, 그렇게 좋지 않은 상황이다.
  > 멀티 레포를 좀 더 거시적 관점으로 바라보고, 물리적으로는 독립적인 코드이지만 하나의 덩어리로 보고 이를 바라 본 관점. '중복 코드'

<br />

#### 모노 레포

성격이 유사한 레포가 지속적으로 추가된다면 도입을 고려해볼 필요가 있다. 많은 컨벤션이 필요하고, 작게 시작하며 노하우를 축적할 필요가 있다. 요즘 많이 어프로치하고 있는 전략 중 하나다.<br />

독립적으로 여러개의 레포를 만들어나가는 게 아니라, 하나의 단일 레포에 멀티 프로젝트를 생성하는 컨셉이 바로 모노 레포다. 이름이 예전의 모놀리식 아키텍처, 하나의 거대한 애플리케이션을 만드는 것과 이름이 되게 유사해서 처음 들어보는 사람들은 그와 비슷하지 않을까 오해할 수도 있지만, 그것과는 전혀 다르다.<br />
리파지토리의 관점에서 여러 개의 프로젝트들을 하나의 'Git' 리파지토리에 묶어 놓는 것을 말한다. 물리적으로 하나의 레파지토리에 묶여져 있다 보니까 당연히 공통 요소들은 그 요소에 독립된 프로젝트로 구성해놓고 나머지 프로젝트들에서 그것들을 공유해서 쓰기가 좋은 구조가 될 것이다. (사실 그걸 목적으로 만들어진 레파지토리)

<br />

### 논리적인 형식

#### 논리적 형식 #1 - Git Flow

<img width="400" src="https://user-images.githubusercontent.com/19165916/195757609-cc55a2ec-9341-4792-89eb-3d56e2ee836e.png"><br />

\: 메인 브랜치가 있고, 개발은 개발 브랜치에서 하고 피처는 피처 브랜치에서 개발을 하고, 그걸 베이스 브랜치로 피처를 따고 핫픽스 따고 릴리즈 할 때 릴리즈 브랜치에 넣고, 태깅하고 뭐 이런 식에 굉장히 근사하지만 굉장히 복잡한 브랜치 전략을 갖고 있는 플로우다. (피로도...🥲) ^^; 좋아보이지만, 사실 모든 상황에 딱 들어맞진 않는다. 한동안 'Git Flow'가 굉장히 유행할 땐, 어떠한 유형의 프로젝트라도 다 이걸 써야만 하는 것 같은 느낌적인 느낌을 받았었지만, 지금은 그렇지 않은... ^^;

<br />

#### 논리적 형식 #2 - GitHub flow

<img width="731" alt="스크린샷 2022-10-14 오후 12 48 10" src="https://user-images.githubusercontent.com/19165916/195758540-2fd3af25-214e-434f-8ed4-8f87b1c18418.png"><br />

\: 'Git Flow'가 성격이 다른, 역할이 다른 메인 브랜치를 만들어놓고 그 브랜치를 왔다갔다 하면서 굉장히 복잡하게 플로우를 타는 것과 달리, 마스터(메인) 브랜치 하나를 가지고 피처를 만들고 바로 머지하고, 피처를 만들고 머지하고, 이런 식의 아주 심플한 로직을 갖고 있는 게 'GitHub flow' 라고 할 수 있다.<br />
이 전략을 가지고도 거의 대부분의 서비스들을 크게 무리없이 개발 할 수가 있다. 물론, 디테일하게는 장단점이 있다.

<br />

#### 논리적 형식 #3 - GitLab flow

<img width="606" alt="스크린샷 2022-10-14 오후 12 51 32" src="https://user-images.githubusercontent.com/19165916/195758619-df70956f-0b27-4c22-a022-b35304696c51.png"><br />

GitHub flow가 너무 단순하다 보니까, 거기에 약간의 메인 브랜치를 좀 추가한 것이다. Production이라고 하는 브랜치를 추가해놓고, 마스터에서 Production으로 그리고 Production 나가기 전 단계인 일종의 develop 브랜치 같은 역할을 하는 PRE-Production이라고 하는 브랜치를 두고, PRE-Production으로 나갔다가 안정성이 확보되면, Production 브랜치로 나가는... 뭐 그런 형식의 브랜치 전략.

<br />

이와 같이 여러 브랜치 전략이 있고, 때에 따라 나만의 브랜치 전략을 만들수도 있을 것이다. 그렇다면 '어떤 걸 기준'으로 골라야 하는가가 핵심이 될 것이다.

<br />

### 무엇을 선택해야할까?

정답을 이야기할 수는 없을 것이다. 회사, 프로젝트, 프로덕트의 상황이 다 다를테니까 말이다. 그러니까, 무엇을 고를 것인가에 대한 '핵심 지표'. 즉, 고민해봐야 하는 지점들에 대해서 한번 이야기해보자.<br />

- 릴리즈 라이프 사이클을 고려하기<br />
  피처의 릴리즈 주기가 얼마나 긴가, 짧은가.<br />
  만약, 일주일에 한 번씩 릴리즈를 한다거나 혹은 한 달에 한 번씩 한 달 동안 개발한거를 배포한다거나하는 라이프 사이클을 갖거나 혹은 매일 매일 릴리즈를 하거나 하루에도 몇 번씩 배포를 하는 등의 라이프 사이클에 따라서 저 세 가지 앞에 대표적인 케이스에 대해서 어떤 게 더 유용한 지가 결정될 수 있다. 예를 들면, 매일 매일 배포하는 프로덕이라고 하면 'Git Flow' 같은 복잡한 브랜치 전략은 엄청 피곤할 것이다. 마치 내가 Git을 쓰려고 서비스를 개발하는건지, 서비스 개발을 위해 Git이 필요한건지 모를 정도로 복잡하고 불필요해 보이는 작업들이 굉장히 많이 있다. ^^; 그럴 땐, 'GitHub flow' 같은 것이 훨씬 적합할 수도 있다.
- 협업 개발자와 팀 규모 고려하기<br />
  이 레파지토리를 관리하는 개발자가 3명... 근데, 'Git flow'를 쓴다면 굉장히 피곤할 것이고, 개발자가 30~40명인 경우 'GitHub Flow' 같은 너무 단순한 브랜치는 마스터에 머지 리퀘스트가 너무 많아서, 관리도 안되고 운영되기가 굉장히 어려운 협소한 전략이 되버릴 수도 있다. 그럴 땐, 'GitLab flow'나 'Git Flow'를 선택하는 게 효과적일 수 있다는 것이다. <br /> (그래서 협업 개발자의 팀 규모에 따라서도 브랜치 전략이 달라질 수 있다는 것)
- 피처 브랜치 라이프사이클 고려하기<br />
  하나의 피처를 개발함에 있어서 굉장히 길게 개발하는 프로덕 유형이 있을 수 있을 것이다. 새로운 기능이 추가되야 하는데 그 새로운 기능은 통상적으로 보통 한 달 두 달씩 걸린다던지 하는 프로덕도 있을 수 있을 것이고, 하나의 피처가 보통 하루 이틀 정도면 충분히 개발이 되는 프로덕 특성을 갖고 있는 경우들도 있을 것이다. 이럴 때 머지 리퀘스트가 얼마나 빈번하게 발생되는가에 대한 부분들도 고려 대상이 될 수 있다.

그래서 릴리즈의 라이프 사이클도 고려해야 되고, 협업자의 수와 스케일도 고려야되야 하고, 피처 브랜치의 통상적인 라이프 사이클도 고려하여 어떤 브랜치 전략이 우리 팀에 가장 맞는가와 저 셋 중에 어떤 걸 베이스로 우리에 맞게 커스터마이징 하는 게 좋은가 라는 부분들을 충분히 고려하고 나서 브랜치 전략을 세우는 것이 좋을 것이다.<br />

하나 당부하고 싶은건, '상황에 맞는 어떤 브랜치 전략이 스탠다드하게 나와 있는 건 없다.'는 것이다. 앞서 본 것과 마찬가지로 많이 쓰이고 베이스 삼을 만한 브랜치 전략은 많이 있지만, 우리들 상황에 꼭 맞는 그런 브랜치 전략은 없으니까 기본적으로 저런 것들 중에 가져와서 '우리에 맞는 커스터 마이징 전략을 세운다'라는 생각을 하는 게 좋다. 이런 이야기를 하는 이유는 '우리팀에 딱 맞는 브랜치 전략이 있었으면 좋겠다'며 감나무 밑에서 감 떨어지기를 기다리는 개발자들이 은근히 많기 때문에... ^^;...<br />
'우리 프로젝트에는 Git Flow도 안 맞는거 같고, GitLab도 안 맞는거 같고, 아 우리한테 맞는 git 브랜치 전략은 없는것인가' 라고 하는 식으로 하늘만 바라보고 있는 개발자가 안 되길 바란다. ^^;
