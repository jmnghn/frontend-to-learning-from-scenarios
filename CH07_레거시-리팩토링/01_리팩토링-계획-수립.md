## 리팩토링 계획 수립

```
1. 레거시와 리팩토링
2. 제안 문서의 구조
3. 제안사항 작성 요령
4. 추가 개선 사항의 중요성
```

### 레거시와 리팩토링

'레거시'. 개발자들이 항상 하는 얘기.<br />
입에 붙어서 하는 이야기 중의 하나가 레거시와 관련된 이야기다.<br />
그리고 리팩토링과 관련된 이야기도 만만치 않게 많이 하는 것 같다. 그만큼 코드라고 하는 것이 내가 작성한 것도 시간이 지나면, 작성한 사람도 까먹듯이 프로덕 코드의 라이프 사이클과 개발자의 라이프 사이클이 굉장히 다르기 때문에 어쩔 수 없는 부분인 것 같다.<br />
그래서 필연적으로 모든 코드는 레거시화 되고, 그리고 시간의 흐름에 따라 상황에 따라 리팩토링이 필요하다. 왜냐하면 끊임없이 운영을 해야하니까 말이다. 그리고 운영을 한다면 효율적으로 잘해야 하니까 언제나 우리에게 레거시와 리팩토링은 큰 화두인 것 같다. 이번 7장에서는 그 레거시와 리팩토링을 실질적으로 지금까지 우리가 만들어왔던 12shop의 몇 가지 지면들을 대상으로 두 번에 걸쳐서 좀 다른 측면의 리팩토링을 진행해 가면서 화두들을 던져 보려 한다.

<br />

여기서는 레거시와 관련해서 리팩토링, 어떻게 계획을 짜고 수립할 것인가. 그리고 어떻게 실행할 것인가에 대한 원론적인 이야기들을 먼저 해보려고 한다.<br />

'이러이러한 코드들 이러이러한 프로덕은 이런 문제가 있어'와 같이 어떤 문제가 있다고 개발자들이 인식을 한다. 하지만 이렇게 인식하는 것과 실제적으로 그 문제가 상존하는 것과 다른 부서 혹은 같은 팀이라도 다른 일을 하고 있는 팀원들에게 그것을 이해시키기 위한 활동은 굉장히 다른 일이라고 생각을 한다. 그것들이 잘못 됐을 때, 그런 이해시키는 과정이 잘못됐을 땐 오해가 생기고, 오해는 결국 갈등을 불러 일으키고 그러다 보면 어떤 것 때문에 우리가 이렇게 갈등을 겪고 있는지 갈 긿을 잃고 헤메는 경우들도 굉장히 많이 봤다. 그럼 안될 것이다. <br />

가장 흔하게 보는 경우 중 하나가 바로 이 경우 인데, 어떤 경우냐면 어떠한 문제점을 갖고 있는 프로덕에 그 문제점을 실제로 커뮤니케이션할 때 가시화하지 않고. 즉, 어떤 감정적인 단어들을 사용해서 '뭔가 거지 같애', '이 애플리케이션 누가 만들었어', '외주 줬다가 가지고 와서 이런 모양이구나. 엉망진창이야', '아 이건 도저히 손 댈 수가 없어요. 새로 만드는 게 훨씬 나아요'와 같은 식의 굉장히 추상적이고, 제 3자가 들었을 때에는 '음... 문제가 있는 건 알겠는데, 대체 얼마나 많은 문제가 있는거야?'라는 걸 인지하기가 굉장히 어려운 식으로 커뮤니케이션 하는 개발자들이 많다라는 것이다. 이걸 보는 사람들도 그런 커뮤니케이션을 하면 안된다라는 측면에서 문서 작성을 해보라 권고를 하고, 어떤 식으로 작성하는지에 대해서 한번 이야기를 해보려고 한다. <br />

이런 문서가 등장한건 RFC 이후로 두 번째다. RFC, 프로젝트가 시작될 때 어떠한 목적으로 어떠한 기능을 어떤 식으로 개발할 것인가라고 하는 문서를 작성했던 케이스. 그리고 이게 두 번째 케이스의 문서인데, 이건 레거시와 관련해서 어떻게 다룰 것인가. 어떻게 가시화할 것에 대한 내용을 개인적으로 해봤을 때 효과적인 방식이라고 생각해서 소개해보려고 한다. 살펴보면서 각각 어떤 효과를 얻을 수 있고 무엇을 해야하는지도 한번 이야기를 해보려고 한다.

```
12shop.com 레거시 웹뷰 개선에 관한 제안 (agenda)
(※ 12shop.com이 벌써 이미 많이 성장을 해서 여러 가지 웹뷰가 생겼고 그 웹뷰 중에서 어떤 건 레거시화 되어 있다라는 이야기. 
그리고 그 레거시화 된 애플리케이션은 '내가 개발하지 않았는데' 혹은 '우리 팀이 개발하지 않았는데', 다른 팀이 개발했다가 어떠어떠한 사정으로 
우리 팀이 개발 역할 혹은 운영 역할을 위임받는 경우가 굉장히 비일비재 하다. 
그래서 코드를 딱 까봤더니 여러가지 문제가 있는 아주 흔한 경우에 맞닥들였을 때, 어떻게 해야 하는가 라고 하는 것이다. 

그래서 이렇게 문서를 먼저 만들어 놓은 다음에 이렇게 작성을 하면 좋다. 
큰 틀에서는 문서가 있고, 이 문서의 활동을 개인 혼자서 하는 건 아닐 것이다. 
물론 혼자서 할 수도 있겠지만, 여러 명이 참여해서 하게 되고 또 오랜 시간에 걸쳐서 진행이 될 예정일 것이다. 
그렇다면 이 웹뷰 개선과 관련된 활동. 이 긴 시간의 활동 맥락을 유지하면서 어떻게 흘러왔는지. 
누군가가 중간에 끼어들어 올 수도 있으니까. 새로운 협업자가 들어온다거나 혹은 새로운 부서가 같이 들어온다거나와 같은 경우 
바로 바로 맥락을다 파악할 수 있게끔 만드는 문서가 있는 건 굉장히 중요하다. 그래서 그런 맥락에서 이렇게 항상 문서를 작성을 한다.)

기여자
정명현 @홍길동 @박동희
(※ 맨 첫 번째에는 무엇보다 이 일을 누가 참여하고 어떤 기여를 했는가. 참여자를 기록하는게 굉장히 중요하다. 그래서 항상 기여자를 맨 위에 놓는다.)

(※ 그리고 두 번째에는 'As-is'와 'To-be'. 그리고 어떤 진행 상황(Progress&Insight, history)를 갖고 있는가에 대한 내용)

# As is
(※ As is는 이 웹뷰 개선과 관련된 프로젝트가 시작되는 그 시점에 파악된 상태들을 명확하게 적시해 놓는 섹션이라고 보면 될 것 같다.)

대상 시스템
(※ 그래서 대상 시스템이 있다.)
· 코인 충전 지면 웹뷰 - webview2.1
  · React 버전이 현행 버전보다 매우 낮은 상태
    · 이로 인해 Hook 등의 최신 기법 사용이 제한적이며 대부분의 컴포넌트가 클래스 컴포넌트로 개발되어 있음.
  · 컴포넌트 재사용성이 매우 떨어짐
    (※ 컴포넌트 재사용성이 매우 떨어지는데, 구체적으로 어떻게 떨어지는지.)
    · 쇼케이스 지면과 동일한 컴포넌트가 다수 포함
    · 동일한 컴포넌트를 매번 여러개 개발 운영해야해서 코스트가 높음
    · 중복된 컴포넌트 리스트
      (※ 핵심주장. 위와 같이 어떤 문제를 제시하는 것도 물론 필요하지만, 항상 그거의 근거가 객관적으로 명확하게 가시화되어 있어야 된다. 
      '중복된 컴포넌트가 많아서 개발 코스트가 높다'까지만 되면, 
      아는 사람들. 이 레거시 프로젝트의 중복 코드가 얼마나 많은지 아는 사람은 고개를 끄덕일 수 있겠지만, 그렇지 않은 사람은 얼마나, 무엇이, 어떻게라는 질문을 할 수밖에 없다. 
      또 그것과 관련된 커뮤니케이션을 하면 중언부언되기 때문에 뭔가 맥락이 다른 데로 흘러갈 수 있다. 
      그래서 애초에 처음 발제를 하고 논의를 시작할 때부터 이렇게 명확하게 하면 뭔가 커뮤니케이션이 꼬일 일이 하나도 없는 것이다. 
      그래서 여기 근거를 항상 이렇게 마련한다. '중복된 컴포넌트 리스트'라고 딱. 넣어놓는 것.)
      (※ PageView, Header, RoundedBox, ... 등등이 현재 중복된 컴포넌트다. 
      그래서 두 벌, 세 벌, 네 벌씩 있다라고 명확히 가시화시켜 놓으면 누가 보더라도 문제라고 받아들이고, 
      빨리 개선한다고 하면 우리가 다양한 측면에서 생산성 향상을 얻을 수 있겠다는 것, 지금 당장은 저걸 하기 위해서 약간 일보 후퇴하지만, 
      이후에는 훨씬 생산적으로 개발할 수 있겠구나라고 당연히 이해할 수 있지 않을까? 
      그러면 당연히 이 프로젝트에 힘을 얻을 수도 있는 것이다. 
      커뮤니케이션 하는 것도 훨씬 깔끔해지고.)
      · PageView - 기본 컨테이너로 모든 프로젝트에 구현되어 있음
      · Header - 네비게이션 컴포넌트로 모든 프로젝트에 중복 구현되어 있음
      · RoundedBox - 기본 컴포넌트로 모든 프로젝트에 중복 구현되어 있음
      · ...
· 쇼케이스 웹뷰 지면 - webview1
  (※ 여기는 버전에 관한 이야기는 없으니까, 그 문제는 없다는 걸 알 수 있을 것이고 
  그러면 컴포넌트만 어떻게 하면 훨씬 더 효과적으로 프로젝트와 프로덕을 운영할 수 있겠구나 하는 판단을할 수 있을 것이다.)
  · 컴포넌트 재사용성이 매우 떨어짐
    · 코인 충전 웹앱과 동일한 상황

(※ As is의 대상 시스템을 파악하고, 문제점들을 가시화해 놓은 섹션)


# To be
(※ To be는 '그럼 어떻게 할거야~'라는 이야기다. 근데 '어떻게 할거야'에 대해서는 항상 두 가지 어프로치를 동시에 진행해야 한다고 생각한다. 
선택지. 즉, 결정권자가 아니고 '다른 사람' 즉, '상위 의사 결정권자'가 있다. 
그게 팀장이든 혹은 그 위의 실장이든 더 높은 의사결정권자든 간에 어떤 식의 결정을 하게 하려면 인포메이션도 좋아야 되고 선택지도 한 개만 주면 안된다. 
여러개를 줘야 한다고 하는 것. 가능하면 여러 개를 줄 수 있다고 하면 어떤 부분들이 효과적인 선택일까에 대한 고민을 할 수 있기 때문이다. 그런데 만약 하나의 선택지만 준다. 
예를 들어, '재개발해야 합니다'와 같이 문제는 있는 건 알겠는데 유일한 선택지가 재개발이라면 뭔가 시간도 오래 걸리고 재개발해서 다시 테스트하고 운영하는데 엄청난 많은 비용이 들텐데 
하는 생각이 먼저 떠오르니까 섣불리 결정하지 못하고 '그렇다고 하면 이걸 정말로 재개발하지 않으면 어떤 일이 벌어지나요' 라는 식으로 보수적인 답변이 돌아오는 확률이 높다는 것이다. 
그래서 선택지를 여러 개를 두는데 기본적으로는 두 가지 정도 선택지를 가지고 플래닝을 해서 제안을 하는 게 가장 좋더라는 이야기를 하고 싶다.)

아키텍처
· 개선 대상 제품은 기본 개선 사항을 먼저 적용한 후 추가적인 개선을 개별 팀 상황에 따라 진행한다.
  (※ 바로, '기본 개선 사항'과 '추가 개선 사항' 이 두 가지로 개선할 수 있는 포인트를 좀 나눈 다음에)
  (※ '기본 개선 사항'은 정말로 개발자가 봤을 때, 
  이건 지금 당장 수정하지 않으면 앞으로도 두고두고 계속 지속적으로 문제가 생길 것 같다고 하는 그런 개선 사항들을 이 기본 개선 사항에 넣고)
  · 기본 개선 사항
    · React 버전 18.x로 상향
    · 공통 컴포넌트를 개별 프로젝트에서 제거 후 컴포넌트 리포의 컴포넌트로 대체
  (※ 추가 개선 사항은 점진적으로 개선할 수 있는 것. 
  기본 개선 사항만 개선되면 하나씩 하나씩 기존 프로젝트 진행들을 하면서, 
  일정들을 소화하면서 중간중간에 개선시켜 나갈 수 있는 것들에 대한 아이템들을 넣어 놓는다.)
  · 추가 개선 사항
    · ...
(※ 이렇게 제안을 하면, 의사 결정권자 입장에서는 훨씬 더 여유롭게 이걸 받아들일 수 있는 생각을 할 수 있게 된다. 
이정도면 여기 약간 투자만하고 그리고 나서 하나는 개발팀에 위임해서 추가 개선 사항들은 점진적으로 개선을 해 나가면 되겠구나 라고 판단을 해나갈 수 있는 것이다. 
그래서 이런 식의 To be에 대한 계획을 항상 제시하라는 이야기...)
(※ 이게 들어보면 당연한 이야기처럼 들리겠지만, 막상 이렇게 하는 개발자와 개발조직이 별로 흔하지 않다. 
하지만 잘하는 개발자, 잘하는 능력있는 개발팀들은 이것과 유사한 일하는 방식 패턴들을 가지고 있다.)

# Progress & Insight
(※ 그리고 진행 사항과 관련된 사항들은 항상 히스토리가 누적되고 업데이트될 수 있도록 같이 해주는게 좋다.)
(※ 계획은, 항상 변한다. 계획은 본질적으로 예상이기 때문에 예상은 실제적으로 일이 진행될 때 틀릴 수 있고, 우리가 예상하지 못한 일들은 언제든지 생길 수 있다. 
그래서 그런 부분들을 어떻게 다루느냐도 유능한 개발자, 유능한 조직을 판별하는 기준이 될 수 있다고 생각을 한다. 
그래서 그 예상과 다른 예외적인 경우들은 어디서 발생하는가. 당연히 진행하면서 발생을 할 것이다. 
그래서 항상 Progress&Insight라고 제목을 정하는 이유중의 하나는 어떤 부분들이 진행이 되고 있고, 어떤 부분들의 예외 사항이. 
즉, 예상하지 못한 일들이 발생했고 그것의 교훈은 무엇이냐. '그럼 그걸 어떻게 처리할거야? 백로그에 넣어서 다음에 처리할거야 아니면 지금 즉시 처리할거야 어떻게할거야? 그리고 
그것들을 우리가 플래닝 할 때 발견하지 못한 근본적인 이유는 무엇인지'에 대한 내용들을 저기다가 적어놓으면 향후에라도 회고를 하면서, 
여기 이 개선 제안과 관련된 문서에서 회고 아이템들도 뽑아내고, 
우리 전사적으로 그것을 우리 팀에 혹은 조직에 더 넓은 범위로는 전사적으로도 동일한 우를 범하지 않는가. 
특정 팀의 문제인지 아니면 전사적으로 우리가 knowledge가 부족한가와 같은 부분들도 파악해 보고 개선사항을 도출해낼 수 있는 것이다. 
그런 측면에서 항상 진행 사항과 인사이트는 항상 기록해두고 여기에 히스토리를 쌓아두라라고 하는 이야기를 드린다.)

· 긍정
  · 공통 컴포넌트 리포 개발로 프로젝트별 중복 컴포넌트 35개가 제거됨.
· 개선 필요
  · 공통 컴포넌트 리포의 개발 주체가 모호하여 커뮤니케이션 코스트가 지속적으로 발생함
    · 공통 컴포넌트를 개발 운영하는 역할을 부여받은 전속 팀 할당 필요
  · ...


(※ History - 여기는 일종의 회의록 같은 곳이다. 어느 날 누가 어떤 의견을 냈고, 어떤 식의 TO-DO가 발생했고, 그 TO-DO는 언제 업데이트가 됐는가. 아럐 샘플있음)

8월 01일
· 정명현님의 제안으로 웹뷰 애플리케이션 중 운영 효율성이 떨어진다고 판단되는 대상 제품을 선정하기로 함
· 운영 효율성이 떨어진다고 판단할 수 있는 기준 마련이 필요함 @김유신
(무엇을 기준으로 운영 효율성이 떨어진다고 판단할지, 그냥 개발자의 취향대로 이건 굉장히 좀 낙후된 구조라고 하는식으로 판단하면 안 된다는 것이다. 
객관성이 항상 담보되어야 하니까 그와 관련한 문제제기를 김유신이라고 하는 분이 했고. 그래서 액션 아이템(TO-DO)가 만들어졌다.)
  · TODO: 웹앱 프로젝트의 운영 효율성을 측정할 기준 마련 due: 2022년 8월 10일
· 대상이 선정되면 우리에게 이를 개선할 시간적 / 인적 여유는 얼마나 있는지 확인이 필요함. @김유신
· ...

8월 10일
· ✅ 웹앱 프로젝트의 운영 효율성을 측정할 기준 @김유신

(※ As-is와 To-be 그리고 Progress는 아래쪽의 히스토리에 누적됨과 동시에 계속 지속적으로 업데이트되는 대상이라고 생각하면 될 것 같다.)
```

> TO-DO 같은 부분은 이슈트래커, 뭐 Jira를 쓰고 있다거나 그런 것들이 있으면 바로 링크로 붙여주면 될 테고, 위키 같은 걸 써도 위키 문서를 써도 된다. '툴이 중요한게 아니라, 이런 문서가 작성이 되고 계속 업데이트 되고 이용된다.' 그리고 이런 어프로치를 한다고 하는게 굉장히 중요한 것이다.

<br />

### 추가 개선 사항의 중요성

추가 개선 사항은 다른 일정들을 진행하면서 지속적으로 개선할 수 있을 만한 아이템, 아젠다를 말하는데, 이게 의미하는 바가 무엇이냐면, 기본 개선 사항과 같이 정말로 기존에 진행되던 일정은 일부 멈추고 이걸 먼저 해야하는 굉장히 강한 디펜던시가 있는 리팩터링도 물론 있지만, 대부분의 개선 사항은 이런 크리티컬한 상황이 해소가 된다고 하면 일상적으로 리팩터링 할 수 있는 대상으로 레벨이 낮아진다라고 할 수 있다. 그래서 그렇게 레벨이 낮아지면 굳이 팀 외부와 커뮤니케이션하지 않고도 안정적으로 리팩터링은 꾸준히 진행해 나갈 수 있다는 것이다. 그렇다고 하면 프로덕 자체가 꾸준히 단단해지고 안정성을 확보하게 되겠고, 커뮤니케이션 코스트도 훨씬 낮아질테니까 우리가 어떤 특정한 서비스나 애플리케이션이 시간이 지나면서 점점 점점 관리되기 힘든 개발되기 힘든 형태로 만들어지는 게 아니라 꾸준히 일정 수준의 복잡도와 퀄리티를 유지해 나가면서 할 수 있게 되는 상황으로 만들어 놓는 것도 개발팀 혹은 개발자의 역량이라고 할 수 있겠다.<br />

그런 역량이 떨어지는 사람은 계속 프로덕을 조금씩 조금씩 엉망으로 만들어가다가 나중에는 '아 도저히 못만들겠어요. 이제는 새로 개발해야되요.'가 되거나 항상 그렇게 개발한 이유가 있긴 하겠지만, 리팩토링은 특정한 시간을 항상 블로킹하고 해야 하는 활동이 아니다. 라는 이야기를 드리고 싶다. 늘 해야하는 일이다. 그런데 늘상 할 수 없는 상황에 블로킹 요소가 있다면, 그런 거는 이런 식으로 한번 떨쳐내고 나서 그리고 여기서 추가 개선 사항들은 단계적으로 일상에서 해결 할 수 있는 방식으로 일을 해나갔으면 좋겠다.<br />

이 문서 형태와 똑같은 형태로 작성하지 않아도 되지만, 전달해 드리는 맥락상의 이런 정보와 흐름들의 요소들은 한번 충분히 다뤄봄직하지 않나라고 생각한다.
